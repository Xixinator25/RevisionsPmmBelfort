<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Révision PMM Belfort - Mobile</title>
    <style>
        :root {
            --navy-blue: #0f1e3d;
            --navy-light: #162c5b;
            --gold: #c5a059;
            --white: #ffffff;
            --light-grey: #eef2f5;
            --red: #b30000;
            --green: #28a745;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            background: var(--light-grey); 
            color: #333; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- EN-TÊTE --- */
        header {
            background: linear-gradient(135deg, var(--navy-blue), var(--navy-light));
            color: var(--white);
            padding: 15px;
            text-align: center;
            border-bottom: 4px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            position: relative;
        }

        .header-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            background: var(--white);
            object-fit: contain;
            padding: 2px;
        }

        .header-text h1 { margin: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        .header-text .subtitle { font-size: 0.8rem; color: #ddd; font-style: italic; margin-top: 2px; }

        .score-display {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.3);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 1px solid var(--gold);
        }

        /* --- NAVIGATION --- */
        nav {
            display: flex;
            background: #12244a;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
            white-space: nowrap;
        }

        nav button {
            background: none;
            border: none;
            color: #ccc;
            padding: 15px 15px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            flex: 1;
            min-width: 80px;
        }

        nav button.active {
            color: var(--white);
            background: rgba(255,255,255,0.05);
            border-bottom: 3px solid var(--gold);
        }

        /* --- CONTENU --- */
        main {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            box-sizing: border-box;
            flex: 1;
        }

        .section-content { display: none; animation: fadeIn 0.3s ease-out; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h2 { 
            color: var(--navy-blue); 
            border-left: 5px solid var(--red); 
            padding-left: 10px; 
            margin: 0 0 15px 0;
            font-size: 1.3rem;
        }

        /* Sous-menu pour NATO */
        .sub-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        .sub-nav button {
            background: #fff;
            border: 1px solid var(--navy-blue);
            color: var(--navy-blue);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .sub-nav button.active {
            background: var(--navy-blue);
            color: white;
        }

        /* --- CARTE QUESTION --- */
        .question-card { 
            background: #fff; 
            padding: 20px; 
            border-radius: 16px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px; 
            border: 1px solid #eee;
            text-align: center;
        }
        
        .question-text { 
            font-size: 1.2rem; 
            font-weight: 700; 
            margin: 15px 0; 
            color: var(--navy-blue); 
        }
        
        .quiz-image-container {
            width: 100%;
            height: 180px;
            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .quiz-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .flag-img-large { height: 120px; width: auto; }
        
        /* --- GRILLE RÉPONSES --- */
        .options-grid { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 12px; 
        }
        @media (min-width: 600px) { .options-grid { grid-template-columns: 1fr 1fr; } }

        button.opt-btn {
            padding: 16px;
            border: 2px solid #e0e0e0;
            background: var(--white);
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            color: #444;
            transition: all 0.2s;
            touch-action: manipulation;
            white-space: normal; /* Permet le texte sur plusieurs lignes */
            line-height: 1.3;
        }
        
        button.opt-btn:active { transform: scale(0.98); }
        button.opt-btn:disabled { opacity: 0.9; cursor: default; }

        /* --- FEEDBACK --- */
        .feedback-box { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 10px; 
            display: none; 
            text-align: left;
            animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .btn-next { 
            background: var(--navy-blue); 
            color: white; 
            border: none; 
            padding: 16px; 
            width: 100%; 
            border-radius: 30px; 
            margin-top: 15px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1.1rem; 
            box-shadow: 0 4px 10px rgba(15, 30, 61, 0.4);
            display: none;
        }

        /* --- TRADUCTEUR --- */
        .translation-zone { background: #fff; padding: 20px; border-radius: 12px; margin-top: 20px; }
        .nato-input { 
            width: 100%; padding: 12px; font-size: 1.1rem; border: 2px solid #ccc; 
            border-radius: 8px; box-sizing: border-box; margin-bottom: 10px;
        }
        .nato-output { 
            background: #1a2f55; padding: 15px; border-radius: 8px; min-height: 50px; 
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
        }
        .nato-item { 
            background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; 
            color: white; font-family: monospace; font-weight: bold; display: flex; align-items: center;
        }
        .nato-flag-mini { height: 20px; margin-right: 8px; border: 1px solid #fff; }

        footer {
            background-color: #12244a;
            color: #8fa1b9;
            text-align: center;
            padding: 20px;
            font-size: 0.8rem;
            margin-top: auto;
            border-top: 4px solid var(--gold);
        }
    </style>
</head>
<body>

<header>
    <div class="score-display">Score: <span id="score-val">0</span></div>
    <img src="images/logo_pmm.png" alt="Logo" class="header-logo" onerror="this.style.display='none'">
    <div class="header-text">
        <h1>PMM Belfort</h1>
        <div class="subtitle">Entraînement & Révisions</div>
    </div>
</header>

<nav>
    <button onclick="switchTab('grades')" class="active">Grades</button>
    <button onclick="switchTab('navires')">Navires</button>
    <button onclick="switchTab('nato')">Code Int.</button>
    <button onclick="switchTab('famas')">FAMAS</button>
</nav>

<main>
    <div id="grades" class="section-content active">
        <h2>Grades & Galons</h2>
        <div id="quiz-grades"></div>
    </div>

    <div id="navires" class="section-content">
        <h2>Bâtiments de Surface</h2>
        <div id="quiz-navires"></div>
    </div>

    <div id="nato" class="section-content">
        <h2>Code International</h2>
        
        <div class="sub-nav">
            <button onclick="setNatoMode('letter')" id="btn-nato-letter" class="active">Alphabet</button>
            <button onclick="setNatoMode('meaning')" id="btn-nato-meaning">Significations</button>
        </div>

        <div id="quiz-nato"></div>
        
        <div class="translation-zone">
            <h3>Traducteur OTAN</h3>
            <input type="text" class="nato-input" placeholder="Tape ton texte..." oninput="translateNato(this.value)">
            <div class="nato-output" id="nato-res"><span style="color:#aaa; font-style:italic;">Résultat...</span></div>
        </div>
    </div>

    <div id="famas" class="section-content">
        <h2>FAMAS G2</h2>
        <div id="quiz-famas"></div>
    </div>
</main>

<footer>
    <div style="color:white; font-weight:bold; margin-bottom:5px;">Site réalisé par un stagiaire de la PMM de Belfort</div>
    <div>Alexis Sartoris - PMM Belfort - 2025/2026</div>
</footer>

<script>
    let currentScore = 0;
    let currentNatoMode = 'letter'; // 'letter' ou 'meaning'

    // --- DONNÉES NATO (Source Unique pour générer les 2 modes) ---
    const natoData = [
        { l: "A", name: "ALFA", m: "J'ai un scaphandrier en plongée.", img: "images/flag_a.png" },
        { l: "B", name: "BRAVO", m: "Je charge/décharge des matières dangereuses.", img: "images/flag_b.png" },
        { l: "C", name: "CHARLIE", m: "Affirmation (OUI).", img: "images/flag_c.png" },
        { l: "D", name: "DELTA", m: "Ne me gênez pas, je manœuvre avec difficulté.", img: "images/flag_d.png" },
        { l: "E", name: "ECHO", m: "Je viens sur tribord.", img: "images/flag_e.png" },
        { l: "F", name: "FOXTROT", m: "Je suis désemparé, communiquez avec moi.", img: "images/flag_f.png" },
        { l: "G", name: "GOLF", m: "J'ai besoin d'un pilote.", img: "images/flag_g.png" },
        { l: "H", name: "HOTEL", m: "J'ai un pilote à bord.", img: "images/flag_h.png" },
        { l: "I", name: "INDIA", m: "Je viens sur bâbord.", img: "images/flag_i.png" },
        { l: "J", name: "JULIETT", m: "Incendie à bord, écartez-vous.", img: "images/flag_j.png" },
        { l: "K", name: "KILO", m: "Je désire communiquer.", img: "images/flag_k.png" },
        { l: "L", name: "LIMA", m: "Stoppez votre navire.", img: "images/flag_l.png" },
        { l: "M", name: "MIKE", m: "Mon navire est stoppé.", img: "images/flag_m.png" },
        { l: "N", name: "NOVEMBER", m: "Négatif (NON).", img: "images/flag_n.png" },
        { l: "O", name: "OSCAR", m: "Homme à la mer.", img: "images/flag_o.png" },
        { l: "P", name: "PAPA", m: "Rappel des équipages / Filets accrochés.", img: "images/flag_p.png" },
        { l: "Q", name: "QUEBEC", m: "Demande libre pratique (Santé).", img: "images/flag_q.png" },
        { l: "R", name: "ROMEO", m: "Pas de signification particulière isolée.", img: "images/flag_r.png" },
        { l: "S", name: "SIERRA", m: "Je bats en arrière.", img: "images/flag_s.png" },
        { l: "T", name: "TANGO", m: "Ne me gênez pas, chalutage en cours.", img: "images/flag_t.png" },
        { l: "U", name: "UNIFORM", m: "Vous courez vers un danger.", img: "images/flag_u.png" },
        { l: "V", name: "VICTOR", m: "Je demande assistance.", img: "images/flag_v.png" },
        { l: "W", name: "WHISKEY", m: "Demande assistance médicale.", img: "images/flag_w.png" },
        { l: "X", name: "X-RAY", m: "Arrêtez vos manœuvres et veillez mes signaux.", img: "images/flag_x.png" },
        { l: "Y", name: "YANKEE", m: "Je chasse sur mon ancre.", img: "images/flag_y.png" },
        { l: "Z", name: "ZULU", m: "J'ai besoin d'un remorqueur.", img: "images/flag_z.png" }
    ];

    // --- BASE DE DONNÉES QUIZ ---
    const db = {
        grades: [
            { img: "images/grade_matelot.jpg", q: "Quel est ce grade ?", options: ["Matelot", "Quartier-Maître de 2ème classe", "Mousse"], a: 0, info: "Pas de galon = Matelot." },
            { img: "images/grade_qm2.jpg", q: "Quel est ce grade ?", options: ["Matelot", "Quartier-Maître de 2ème classe", "Quartier-Maître de 1ère classe"], a: 1, info: "2 chevrons rouges = Quartier-Maître de 2ème classe." },
            { img: "images/grade_qm1.jpg", q: "Quel est ce grade ?", options: ["Quartier-Maître de 2ème classe", "Quartier-Maître de 1ère classe", "Second Maître"], a: 1, info: "1 chevron rouge = Quartier-Maître de 1ère classe." },
            { img: "images/grade_sm_maistrancier.jpg", q: "Quel est ce grade (barré de rouge) ?", options: ["Second Maître Maistrancier", "Second Maître", "Quartier-Maître"], a: 0, info: "Second Maître Maistrancier (Élève)." },
            { img: "images/grade_sm_brevete.jpg", q: "Quel est ce grade (barré de bleu) ?", options: ["Second Maître Maistrancier", "Second Maître Breveté Maistrancier", "Maître"], a: 1, info: "Second Maître Breveté Maistrancier." },
            { img: "images/grade_sm.jpg", q: "Quel est ce grade ?", options: ["Second Maître", "Maître", "Premier Maître"], a: 0, info: "2 chevrons or = Second Maître." },
            { img: "images/grade_m.jpg", q: "Quel est ce grade ?", options: ["Second Maître", "Maître", "Premier Maître"], a: 1, info: "3 chevrons or = Maître." },
            { img: "images/grade_pm.jpg", q: "Quel est ce grade ?", options: ["Maître", "Premier Maître", "Maître Principal"], a: 1, info: "1 galon or = Premier Maître." },
            { img: "images/grade_mp.jpg", q: "Quel est ce grade ?", options: ["Premier Maître", "Maître Principal", "Major"], a: 1, info: "1 galon or 'sabordé' = Maître Principal (Cipal)." },
            { img: "images/grade_major.jpg", q: "Quel est ce grade ?", options: ["Maître Principal", "Major", "Aspirant"], a: 1, info: "1 galon or + ancre = Major." },
            { img: "images/grade_asp.jpg", q: "Quel est ce grade ?", options: ["Aspirant", "Enseigne de Vaisseau de 2ème classe", "Enseigne de Vaisseau de 1ère classe"], a: 0, info: "1 galon or coupé = Aspirant (Lieutenant)." },
            { img: "images/grade_ev2.jpg", q: "Quel est ce grade ?", options: ["Aspirant", "Enseigne de Vaisseau de 2ème classe", "Enseigne de Vaisseau de 1ère classe"], a: 1, info: "1 galon or = Enseigne de Vaisseau de 2ème classe." },
            { img: "images/grade_ev1.jpg", q: "Quel est ce grade ?", options: ["Enseigne de Vaisseau de 2ème classe", "Enseigne de Vaisseau de 1ère classe", "Lieutenant de Vaisseau"], a: 1, info: "2 galons or = Enseigne de Vaisseau de 1ère classe." },
            { img: "images/grade_lv.jpg", q: "Quel est ce grade ?", options: ["Enseigne de Vaisseau de 1ère classe", "Lieutenant de Vaisseau", "Capitaine de Corvette"], a: 1, info: "3 galons or = Lieutenant de Vaisseau (Capitaine)." },
            { img: "images/grade_cc.jpg", q: "Quel est ce grade ?", options: ["Lieutenant de Vaisseau", "Capitaine de Corvette", "Capitaine de Frégate"], a: 1, info: "4 galons panachés = Capitaine de Corvette (Commandant)." },
            { img: "images/grade_cf.jpg", q: "Quel est ce grade ?", options: ["Capitaine de Corvette", "Capitaine de Frégate", "Capitaine de Vaisseau"], a: 1, info: "5 galons panachés (3 Or, 2 Argent) = Capitaine de Frégate." },
            { img: "images/grade_cv.jpg", q: "Quel est ce grade ?", options: ["Capitaine de Frégate", "Capitaine de Vaisseau", "Contre-Amiral"], a: 1, info: "5 galons or = Capitaine de Vaisseau." },
            { img: "images/grade_ca.jpg", q: "Quel est ce grade ?", options: ["Capitaine de Vaisseau", "Contre-Amiral", "Vice-Amiral"], a: 1, info: "2 étoiles = Contre-Amiral." },
            { img: "images/grade_va.jpg", q: "Quel est ce grade ?", options: ["Contre-Amiral", "Vice-Amiral", "Vice-Amiral d'Escadre"], a: 1, info: "3 étoiles = Vice-Amiral." },
            { img: "images/grade_vae.jpg", q: "Quel est ce grade ?", options: ["Vice-Amiral", "Vice-Amiral d'Escadre", "Amiral"], a: 1, info: "4 étoiles = Vice-Amiral d'Escadre." },
            { img: "images/grade_amiral.jpg", q: "Quel est ce grade ?", options: ["Vice-Amiral d'Escadre", "Amiral", "Amiral de France"], a: 1, info: "5 étoiles = Amiral." }
        ],

        // LISTE ORIGINALE DU NAVIRE - INCHANGÉE
        navires: [
            { img: "images/navire_pa.jpg", q: "Type de bâtiment ?", options: ["Porte-Avions", "Porte-Hélicoptères Amphibie", "Bâtiment Ravitailleur"], a: 0, info: "Porte-Avions (Charles de Gaulle)." },
            { img: "images/navire_fremm.jpg", q: "Type de bâtiment ?", options: ["Frégate de Surveillance", "Frégate Multi-Missions", "Patrouilleur de Haute Mer"], a: 1, info: "Frégate Multi-Missions (FREMM)." },
            { img: "images/navire_fremm_da.jpg", q: "Type de bâtiment ?", options: ["Frégate Multi-Mission à capacité de défense aérienne renforcée", "Frégate Type La Fayette", "Patrouilleur"], a: 0, info: "Frégate Multi-Mission à capacité de défense aérienne renforcée (FREMM-DA)." },
            { img: "images/navire_fdi.jpg", q: "Type de bâtiment ?", options: ["Frégate de Défense et d'Intervention", "Frégate de Surveillance", "Chasseur de Mines"], a: 0, info: "Frégate de Défense et d'Intervention (FDI)." },
            { img: "images/navire_fs.jpg", q: "Type de bâtiment ?", options: ["Frégate de Surveillance", "Patrouilleur Polaire", "Bâtiment Hydrographique"], a: 0, info: "Frégate de Surveillance (Floréal)." },
            { img: "images/navire_phm.jpg", q: "Type de bâtiment ?", options: ["Patrouilleur de Haute Mer", "Patrouilleur Côtier", "Chasseur de Mines"], a: 0, info: "Patrouilleur de Haute Mer (PHM)." },
            { img: "images/navire_pom.jpg", q: "Type de bâtiment ?", options: ["Patrouilleur Outre-Mer", "Patrouilleur de Service Public", "Bâtiment de Soutien"], a: 0, info: "Patrouilleur Outre-Mer (POM)." },
            { img: "images/navire_pag.jpg", q: "Type de bâtiment ?", options: ["Patrouilleur Antilles Guyane", "Patrouilleur de Haute Mer", "Remorqueur"], a: 0, info: "Patrouilleur Antilles Guyane (PAG)." },
            { img: "images/navire_psp.jpg", q: "Type de bâtiment ?", options: ["Patrouilleur de Service Public", "Bâtiment Base de Plongeurs", "Engin de Débarquement"], a: 0, info: "Patrouilleur de Service Public (PSP)." },
            { img: "images/navire_patrouilleur.jpg", q: "Type de bâtiment ?", options: ["Patrouilleur", "Frégate", "Porte-Avions"], a: 0, info: "Patrouilleur (Divers)." },
            { img: "images/navire_polaire.jpg", q: "Type de bâtiment ?", options: ["Patrouilleur Polaire", "Pétrolier Ravitailleur", "Bâtiment d'Essais"], a: 0, info: "Patrouilleur Polaire (L'Astrolabe)." },
            { img: "images/navire_cmt.jpg", q: "Type de bâtiment ?", options: ["Chasseur de Mines Tripartite", "Patrouilleur", "Remorqueur"], a: 0, info: "Chasseur de Mines Tripartite (CMT)." },
            { img: "images/navire_bbpd.jpg", q: "Type de bâtiment ?", options: ["Bâtiment Base de Plongeurs Démineurs", "Bâtiment Hydrographique", "Frégate"], a: 0, info: "Bâtiment Base de Plongeurs Démineurs (BBPD)." },
            { img: "images/navire_brs.jpg", q: "Type de bâtiment ?", options: ["Bâtiment Remorqueur de Sonar", "Bâtiment Ravitailleur", "Chasseur de Mines"], a: 0, info: "Bâtiment Remorqueur de Sonar (BRS)." },
            { img: "images/navire_begm.jpg", q: "Type de bâtiment ?", options: ["Bâtiment d'Expérimentation de Guerre des Mines", "Bâtiment École", "Patrouilleur"], a: 0, info: "Bâtiment d'Expérimentation de Guerre des Mines (BEGM)." },
            { img: "images/navire_brf.jpg", q: "Type de bâtiment ?", options: ["Bâtiment Ravitailleur de Forces", "Bâtiment de Soutien", "Porte-Hélicoptères"], a: 0, info: "Bâtiment Ravitailleur de Forces (BRF)." },
            { img: "images/navire_bcr.jpg", q: "Type de bâtiment ?", options: ["Bâtiment de Commandement et Ravitaillement", "Frégate", "Patrouilleur"], a: 0, info: "Bâtiment de Commandement et Ravitaillement (BCR)." },
            { img: "images/navire_bsam.jpg", q: "Type de bâtiment ?", options: ["Bâtiment de Soutien et d'Assistance Métropolitain", "Patrouilleur", "Chasseur de Mines"], a: 0, info: "Bâtiment de Soutien et d'Assistance Métropolitain (BSAM)." },
            { img: "images/navire_bsaom.jpg", q: "Type de bâtiment ?", options: ["Bâtiment de Soutien et d'Assistance Outre-Mer", "Frégate de Surveillance", "Patrouilleur"], a: 0, info: "Bâtiment de Soutien et d'Assistance Outre-Mer (BSAOM)." },
            { img: "images/navire_rpc.jpg", q: "Type de bâtiment ?", options: ["Remorqueur Portuaire Côtier", "Patrouilleur", "Engin de Débarquement"], a: 0, info: "Remorqueur Portuaire Côtier (RPC)." },
            { img: "images/navire_bem.jpg", q: "Type de bâtiment ?", options: ["Bâtiment d'Essais et de Mesures", "Bâtiment de Renseignement", "Porte-Avions"], a: 0, info: "Bâtiment d'Essais et de Mesures (BEM)." },
            { img: "images/navire_bre.jpg", q: "Type de bâtiment ?", options: ["Bâtiment de Renseignement Électromagnétique", "Bâtiment Hydrographique", "Frégate"], a: 0, info: "Bâtiment de Renseignement Électromagnétique (BRE)." },
            { img: "images/navire_bho.jpg", q: "Type de bâtiment ?", options: ["Bâtiment Hydrographique et Océanographique", "Patrouilleur Polaire", "Chasseur de Mines"], a: 0, info: "Bâtiment Hydrographique et Océanographique (BHO)." },
            { img: "images/navire_voilier.jpg", q: "Type de bâtiment ?", options: ["Voilier École", "Frégate", "Patrouilleur"], a: 0, info: "Voilier École." },
            { img: "images/navire_erf.jpg", q: "Type de bâtiment ?", options: ["Embarcation Remonte Filets", "Engin de Débarquement", "Remorqueur"], a: 0, info: "Embarcation Remonte Filets (ERF)." },
            { img: "images/navire_eda.jpg", q: "Type de bâtiment ?", options: ["Engin de Débarquement Amphibie", "Patrouilleur", "Remorqueur"], a: 0, info: "Engin de Débarquement Amphibie (EDA)." }
        ],

        famas: [
            { img: "images/famas_ensemble_mobile.jpg", q: "Quelle est cette pièce centrale ?", options: ["L'ensemble mobile", "La culasse", "Le percuteur"], a: 0, info: "L'ensemble mobile." },
            { img: "images/famas_chargeur.jpg", q: "Contenance du chargeur (G2) ?", options: ["30 cartouches", "25 cartouches", "20 cartouches"], a: 0, info: "30 cartouches (Standard OTAN)." },
            { img: "images/famas_selecteur.jpg", q: "Position '1' sur le sélecteur ?", options: ["Semi-auto (Coup par coup)", "Rafale", "Sûreté"], a: 0, info: "1 = Tir en coup par coup." },
            { img: "images/famas_general.jpg", q: "Quel est ce modèle ?", options: ["FAMAS G2", "FAMAS F1", "HK 416"], a: 0, info: "FAMAS G2 (Pontet large)." },
            { img: "images/famas_boitier.jpg", q: "Nom de cette pièce ?", options: ["Boîtier de mécanisme", "Ensemble mobile", "PGM"], a: 0, info: "Boîtier de Mécanisme (Pièce de sécurité)." },
            { img: "images/famas_limiteur.jpg", q: "À quoi sert la commande '0' ou '3' ?", options: ["Limiteur de rafale", "Sélecteur de tir", "Sûreté"], a: 0, info: "Limiteur de Rafale (0=Libre, 3=Trois coups)." },
            { img: "images/famas_poignee.jpg", q: "Identifiez cet ensemble :", options: ["Poignée Garde-Main (PGM)", "Crosse", "Canon"], a: 0, info: "Poignée Garde-Main." },
            { img: "images/famas_crosse.jpg", q: "Pièce mobile pour viser sur la crosse ?", options: ["L'appui-joue", "L'amortisseur", "La fenêtre d'éjection"], a: 0, info: "L'appui-joue." },
            { q: "Portée pratique du FAMAS G2 ?", options: ["300 m", "200 m", "600 m"], a: 0, info: "300 mètres." },
            { q: "Cadence de tir théorique ?", options: ["1000 coups/mn", "600 coups/mn", "100 coups/mn"], a: 0, info: "1000 à 1100 coups/minute." },
            { q: "Grenades tirées par le FAMAS ?", options: ["Mixtes (AP/AV)", "Fumigènes", "De 120mm"], a: 0, info: "Grenades Mixtes (Anti-Personnel / Anti-Véhicule)." }
        ]
    };

    // --- MOTEUR ---
    
    function switchTab(id) {
        document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
        
        if (id === 'nato') {
            loadNatoQuestion(); // Charge le mode actuel
        } else if (db[id]) {
            loadQuestion(id);
        }
    }

    // Gestion des modes NATO
    function setNatoMode(mode) {
        currentNatoMode = mode;
        document.getElementById('btn-nato-letter').classList.toggle('active', mode === 'letter');
        document.getElementById('btn-nato-meaning').classList.toggle('active', mode === 'meaning');
        loadNatoQuestion();
    }

    function loadQuestion(cat) {
        const container = document.getElementById(`quiz-${cat}`);
        const qData = db[cat][Math.floor(Math.random() * db[cat].length)];
        renderQuizCard(container, qData, cat);
    }

    function loadNatoQuestion() {
        const container = document.getElementById('quiz-nato');
        const item = natoData[Math.floor(Math.random() * natoData.length)];
        let qData = {};

        if (currentNatoMode === 'letter') {
            // MODE LETTRE : On montre le drapeau, on cherche le NOM (Alpha, Bravo...)
            qData = {
                img: item.img,
                q: "Quel est ce pavillon ?",
                info: `${item.name} : ${item.m}`,
                a: 0 // La bonne réponse sera toujours à l'index 0 avant mélange
            };
            // Générer 2 mauvaises réponses au hasard
            let others = natoData.filter(x => x.l !== item.l).sort(() => 0.5 - Math.random()).slice(0, 2);
            qData.options = [item.name, others[0].name, others[1].name];

        } else {
            // MODE SIGNIFICATION : On montre le drapeau (ou le nom), on cherche la SIGNIFICATION
            qData = {
                img: item.img,
                q: `Que signifie le pavillon ${item.name} ?`,
                info: `${item.name} : ${item.m}`,
                a: 0
            };
            let others = natoData.filter(x => x.l !== item.l).sort(() => 0.5 - Math.random()).slice(0, 2);
            qData.options = [item.m, others[0].m, others[1].m];
        }

        renderQuizCard(container, qData, 'nato', true); // true = force refresh si nato
    }

    function renderQuizCard(container, qData, cat, isNato = false) {
        // Préparation des options
        let options = qData.options.map((opt, index) => {
            return { text: opt, isCorrect: (index === qData.a) };
        });
        options = options.sort(() => Math.random() - 0.5);

        // Image handling
        let imageHTML = '';
        if (qData.img) {
            let imgClass = cat === 'nato' ? 'quiz-image flag-img-large' : 'quiz-image';
            imageHTML = `
                <div class="quiz-image-container">
                    <img src="${qData.img}" class="${imgClass}" alt="Image" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'color:#999\\'>Image manquante<br>${qData.img}</span>'">
                </div>`;
        }

        container.innerHTML = `
            <div class="question-card">
                ${imageHTML}
                <div class="question-text">${qData.q}</div>
                <div class="options-grid">
                    ${options.map(opt => 
                        `<button class="opt-btn" onclick="check(this, ${opt.isCorrect}, '${qData.info.replace(/'/g, "\\'")}')">${opt.text}</button>`
                    ).join('')}
                </div>
                <div class="feedback-box"></div>
                <button class="btn-next" onclick="${isNato ? 'loadNatoQuestion()' : `loadQuestion('${cat}')`}">Question Suivante →</button>
            </div>
        `;
    }

    function check(btn, isCorrect, info) {
        const card = btn.closest('.question-card');
        const feedback = card.querySelector('.feedback-box');
        
        card.querySelectorAll('.opt-btn').forEach(b => {
            b.disabled = true;
            if(b === btn && !isCorrect) {
                b.style.background = "#ffebee";
                b.style.borderColor = "#ffcdd2";
                b.style.color = "#c62828";
            }
        });

        if(isCorrect) {
            btn.style.background = "#e8f5e9";
            btn.style.borderColor = "#a5d6a7";
            btn.style.color = "#2e7d32";
            feedback.innerHTML = `<strong style="color:#2e7d32;">✔ Bonne réponse !</strong><br>${info}`;
            feedback.style.background = "#e8f5e9";
            feedback.style.border = "1px solid #c8e6c9";
            updateScore(10);
        } else {
            feedback.innerHTML = `<strong style="color:#c62828;">✘ Incorrect.</strong><br>${info}`;
            feedback.style.background = "#ffebee";
            feedback.style.border = "1px solid #ffcdd2";
        }
        
        feedback.style.display = 'block';
        card.querySelector('.btn-next').style.display = 'block';
    }

    function updateScore(points) {
        currentScore += points;
        document.getElementById('score-val').innerText = currentScore;
    }

    function translateNato(text) {
        const output = document.getElementById('nato-res');
        if(!text.trim()) { output.innerHTML = "<span style='color:#aaa; font-style:italic;'>Résultat...</span>"; return; }
        
        output.innerHTML = text.toUpperCase().split('').map(char => {
            let found = natoData.find(item => item.l === char);
            if (found) {
                return `<div class="nato-item">
                            <img src="${found.img}" class="nato-flag-mini" onerror="this.style.display='none'">
                            ${found.name}
                        </div>`;
            } else if (char.match(/[0-9]/)) {
                 return `<div class="nato-item">${char}</div>`;
            }
            return char === ' ' ? '<div style="width:100%"></div>' : '';
        }).join('');
    }

    // Init
    loadQuestion('grades');
</script>

</body>
</html>
