<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R√©vision PMM Belfort - Mobile</title>
    <style>
        :root {
            --navy-blue: #0f1e3d;
            --navy-light: #162c5b;
            --gold: #c5a059;
            --white: #ffffff;
            --light-grey: #eef2f5;
            --red: #b30000;
            --green: #28a745;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            background: var(--light-grey); 
            color: #333; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- EN-T√äTE --- */
        header {
            background: linear-gradient(135deg, var(--navy-blue), var(--navy-light));
            color: var(--white);
            padding: 15px;
            text-align: center;
            border-bottom: 4px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            position: relative;
        }

        .header-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            background: var(--white);
            object-fit: contain;
            padding: 2px;
        }

        .header-text h1 { margin: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        .header-text .subtitle { font-size: 0.8rem; color: #ddd; font-style: italic; margin-top: 2px; }

        .score-display {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.3);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 1px solid var(--gold);
        }

        /* --- NAVIGATION --- */
        nav {
            display: flex;
            background: #12244a;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
            white-space: nowrap;
        }

        nav button {
            background: none;
            border: none;
            color: #ccc;
            padding: 15px 15px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            flex: 1;
            min-width: 80px;
        }

        nav button.active {
            color: var(--white);
            background: rgba(255,255,255,0.05);
            border-bottom: 3px solid var(--gold);
        }

        /* --- CONTENU --- */
        main {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            box-sizing: border-box;
            flex: 1;
        }

        .section-content { display: none; animation: fadeIn 0.3s ease-out; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h2 { 
            color: var(--navy-blue); 
            border-left: 5px solid var(--red); 
            padding-left: 10px; 
            margin: 0 0 15px 0;
            font-size: 1.3rem;
        }

        /* Sous-menu (NATO & Sac) */
        .sub-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        .sub-nav button {
            background: #fff;
            border: 1px solid var(--navy-blue);
            color: var(--navy-blue);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .sub-nav button.active {
            background: var(--navy-blue);
            color: white;
        }

        /* --- CARTE QUESTION --- */
        .question-card { 
            background: #fff; 
            padding: 20px; 
            border-radius: 16px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px; 
            border: 1px solid #eee;
            text-align: center;
        }
        
        .question-text { 
            font-size: 1.2rem; 
            font-weight: 700; 
            margin: 15px 0; 
            color: var(--navy-blue); 
        }
        
        .quiz-image-container {
            width: 100%;
            height: 180px;
            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .quiz-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .flag-img-large { height: 120px; width: auto; }
        
        /* --- GRILLE R√âPONSES --- */
        .options-grid { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 12px; 
        }
        @media (min-width: 600px) { .options-grid { grid-template-columns: 1fr 1fr; } }

        button.opt-btn {
            padding: 16px;
            border: 2px solid #e0e0e0;
            background: var(--white);
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            color: #444;
            transition: all 0.2s;
            touch-action: manipulation;
            white-space: normal;
            line-height: 1.3;
        }
        
        button.opt-btn:active { transform: scale(0.98); }
        button.opt-btn:disabled { opacity: 0.9; cursor: default; }

        /* --- FEEDBACK --- */
        .feedback-box { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 10px; 
            display: none; 
            text-align: left;
            animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .btn-next { 
            background: var(--navy-blue); 
            color: white; 
            border: none; 
            padding: 16px; 
            width: 100%; 
            border-radius: 30px; 
            margin-top: 15px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1.1rem; 
            box-shadow: 0 4px 10px rgba(15, 30, 61, 0.4);
            display: none;
        }

        /* --- TRADUCTEUR --- */
        .translation-zone { background: #fff; padding: 20px; border-radius: 12px; margin-top: 20px; }
        .nato-input { 
            width: 100%; padding: 12px; font-size: 1.1rem; border: 2px solid #ccc; 
            border-radius: 8px; box-sizing: border-box; margin-bottom: 10px;
        }
        .nato-output { 
            background: #1a2f55; padding: 15px; border-radius: 8px; min-height: 50px; 
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
        }
        .nato-item { 
            background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; 
            color: white; font-family: monospace; font-weight: bold; display: flex; align-items: center;
        }
        .nato-flag-mini { height: 20px; margin-right: 8px; border: 1px solid #fff; }

        /* --- BONUS & CHECKLIST --- */
        .bonus-card {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        .bonus-title {
            color: var(--navy-blue);
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--light-grey);
            padding-bottom: 8px;
        }
        
        /* Style sp√©cifique pour le Code du Marin & R√®gles S√©cu */
        .text-block p {
            margin: 0 0 12px 0;
            padding-left: 10px;
            border-left: 3px solid var(--gold);
        }
        .text-block strong {
            color: var(--navy-blue);
        }

        /* R√®gles s√©cu specifique */
        .secu-rule {
            margin-bottom: 15px;
            border-bottom: 1px dashed #e0e0e0;
            padding-bottom: 10px;
        }
        .secu-rule:last-child { border-bottom: none; }
        .secu-title { font-weight: bold; color: #d32f2f; display: block; margin-bottom: 4px; }
        .secu-reason { display: block; font-style: italic; color: #555; font-size: 0.85rem; margin-top: 3px; }

        .checklist-container div:active { background-color: #f9f9f9; }
        .btn-reset { margin-top:15px; padding:12px; width:100%; background:#f1f1f1; border:none; border-radius:8px; color:#555; font-weight:bold; cursor: pointer; }

        footer {
            background-color: #12244a;
            color: #8fa1b9;
            text-align: center;
            padding: 20px;
            font-size: 0.8rem;
            margin-top: auto;
            border-top: 4px solid var(--gold);
        }
    </style>
</head>
<body>

<header>
    <div class="score-display">Score: <span id="score-val">0</span></div>
    <img src="images/logo_pmm.png" alt="Logo" class="header-logo" onerror="this.style.display='none'">
    <div class="header-text">
        <h1>PMM Belfort</h1>
        <div class="subtitle">Entra√Ænement & R√©visions</div>
    </div>
</header>

<nav>
    <button onclick="switchTab('grades')" class="active">Grades</button>
    <button onclick="switchTab('navires')">Navires</button>
    <button onclick="switchTab('nato')">Code Int.</button>
    <button onclick="switchTab('famas')">FAMAS</button>
    <button onclick="switchTab('bonus')">Bonus</button>
</nav>

<main>
    <div id="grades" class="section-content active">
        <h2>Grades & Galons</h2>
        <div id="quiz-grades"></div>
    </div>

    <div id="navires" class="section-content">
        <h2>B√¢timents de Surface</h2>
        
        <div class="bonus-card" style="margin-bottom: 20px; background: #e3f2fd; border-color: #bbdefb;">
            <div class="bonus-title">üß† M√©mo Navigation</div>
            <div style="display:flex; justify-content:space-around; text-align:center;">
                <div style="flex:1;">
                    <div style="font-weight:bold; color:#b30000;">B√ÇBORD</div>
                    <div style="font-size:2rem;">üî¥</div>
                    <div style="font-size:0.8rem;">(Gauche)</div>
                </div>
                <div style="flex:1; border-left:1px solid #ccc;">
                    <div style="font-weight:bold; color:#28a745;">TRIBORD</div>
                    <div style="font-size:2rem;">üü¢</div>
                    <div style="font-size:0.8rem;">(Droite)</div>
                </div>
            </div>
            <p style="text-align:center; font-size:0.85rem; margin-top:10px; color:#555;">
                Astuce : Le mot <strong>BATTERIE</strong>.<br>
                <strong>BA</strong> (B√¢bord) est √† gauche en Rouge.<br>
                <strong>TRI</strong> (Tribord) est √† droite en Vert.
            </p>
        </div>

        <div id="quiz-navires"></div>
    </div>

    <div id="nato" class="section-content">
        <h2>Code International</h2>
        
        <div class="sub-nav">
            <button onclick="setNatoMode('letter')" id="btn-nato-letter" class="active">Alphabet</button>
            <button onclick="setNatoMode('meaning')" id="btn-nato-meaning">Significations</button>
        </div>

        <div id="quiz-nato"></div>
        
        <div class="translation-zone">
            <h3>Traducteur OTAN</h3>
            <input type="text" class="nato-input" placeholder="Tape ton texte..." oninput="translateNato(this.value)">
            <div class="nato-output" id="nato-res"><span style="color:#aaa; font-style:italic;">R√©sultat...</span></div>
        </div>
    </div>

    <div id="famas" class="section-content">
        <h2>FAMAS G2</h2>

        <div class="bonus-card" style="background: #fff3e0; border: 1px solid #ffe0b2;">
            <div class="bonus-title" style="border-bottom-color:#ffe0b2;">‚ö†Ô∏è 4 R√®gles de S√©curit√©</div>
            <div style="text-align: left; padding: 5px;">
                
                <div class="secu-rule">
                    <span class="secu-title">1. Une arme doit toujours √™tre consid√©r√©e comme charg√©e.</span>
                    <span class="secu-reason">üëâ C'est la cause de tous les accidents.</span>
                </div>

                <div class="secu-rule">
                    <span class="secu-title">2. Ne jamais pointer ou laisser pointer le canon d'une arme sur quelque chose que l'on ne veut pas d√©truire.</span>
                    <span class="secu-reason">üëâ C'est la cause de tous les accidents.</span>
                </div>

                <div class="secu-rule">
                    <span class="secu-title">3. Garder l'index hors de la d√©tente tant que les organes de vis√©e ne sont pas sur l'objectif.</span>
                    <span class="secu-reason">üëâ Afin d'√©viter les d√©parts de coups dus √† une crispation musculaire (mettre le doigt sur la d√©tente est plus rapide que de prendre une vis√©e).</span>
                </div>

                <div class="secu-rule">
                    <span class="secu-title">4. √ätre s√ªr de son objectif et de son environnement.</span>
                    <span class="secu-reason">üëâ Afin d'√©viter les dommages collat√©raux et les tirs fratricides.</span>
                </div>

            </div>
        </div>
        <div id="quiz-famas"></div>
    </div>

    <div id="bonus" class="section-content">
        <h2>Outils & Bonus</h2>

        <div class="bonus-card">
            <div class="bonus-title">üìú Code du Marin</div>
            <div class="text-block" style="font-size:0.9rem; line-height:1.4; color:#333; text-align:justify; max-height:250px; overflow-y:auto; padding:10px; background:#f9f9f9; border-radius:8px; border:1px solid #eee;">
                <p><strong>Au service de la nation,</strong> je lui suis enti√®rement d√©vou√©, en tout temps et en tout lieu.</p>
                <p><strong>D√©termin√©,</strong> j'accomplis ma mission avec abn√©gation, si n√©cessaire au p√©ril de ma vie.</p>
                <p><strong>Conscient de la force dont je suis d√©positaire,</strong> j'ob√©is aux ordres, dans le respect des lois, de l‚Äô√©thique et des conventions internationales.</p>
                <p><strong>Membre de la communaut√© des gens de mer,</strong> je m‚Äôattache √† la sauvegarde de la vie en mer.</p>
                <p><strong>Marin professionnel,</strong> j'entretiens mes capacit√©s intellectuelles et physiques, et d√©veloppe en permanence ma comp√©tence et ma force morale.</p>
                <p><strong>Je fais preuve d‚Äôinitiative</strong> et m‚Äôadapte en toutes circonstances, dans l‚Äôexercice quotidien de mon m√©tier et les situations extr√™mes des missions op√©rationnelles.</p>
                <p><strong>Homme ou femme d‚Äôun m√™me groupe solidaire,</strong> j'agis avec honneur, franchise et loyaut√©.</p>
                <p><strong>Attentif aux autres et d√©termin√© √† surmonter les difficult√©s,</strong> j'≈ìuvre pour la coh√©sion et le dynamisme de mon √©quipe, de mon service, de mon unit√©.</p>
                <p><strong>Je m‚Äôattache √† maintenir l‚Äôesprit d‚Äô√©quipage,</strong> en mer comme √† terre.</p>
                <p><strong>Je suis ouvert sur le monde et la soci√©t√©,</strong> dont je connais les valeurs et respecte les diff√©rences.</p>
                <p><strong>Je m‚Äôexprime avec r√©serve</strong> pour ne pas porter atteinte √† la neutralit√© des arm√©es en mati√®re philosophique, politique ou religieuse.</p>
                <p><strong>Fier de mon engagement,</strong> je suis, en uniforme comme en civil, un ambassadeur de ma sp√©cialit√©, de mon unit√©, de la marine nationale et de la France.</p>
            </div>
        </div>

        <div class="bonus-card">
            <div class="bonus-title">üéµ Chants PMM</div>
            <select id="chant-select" onchange="showChant(this.value)" style="width:100%; padding:10px; border-radius:8px; margin-bottom:15px; font-size:1rem; border:1px solid #ccc;">
                <option value="">-- Choisir un chant --</option>
                <option value="santiano">Santiano</option>
                <option value="strasbourgeoise">La Strasbourgeoise</option>
            </select>
            
            <div id="chant-display" style="white-space: pre-line; background:#f9f9f9; padding:15px; border-radius:8px; font-size:0.95rem; line-height:1.5; display:none; border:1px solid #eee; max-height:300px; overflow-y:auto;"></div>
        </div>

        <div class="bonus-card">
            <div class="bonus-title">üéí Checklist Vestimentaire</div>
            
            <div class="sub-nav" style="margin-bottom: 15px;">
                <button onclick="setSacMode('homme')" id="btn-sac-homme" class="active">Homme</button>
                <button onclick="setSacMode('femme')" id="btn-sac-femme">Femme</button>
            </div>

            <p style="font-style:italic; color:#666; font-size:0.9rem; margin-top:0;">Liste pour c√©r√©monie :</p>
            <div id="checklist-container" style="text-align: left;">
                </div>
            <button onclick="resetChecklist()" class="btn-reset">Tout d√©cocher</button>
        </div>

        <div class="bonus-card" style="opacity: 0.7;">
            <div class="bonus-title">‚öì √Ä venir...</div>
            <p style="color:#666;">D'autres outils seront ajout√©s ici (Matelotage, S√©curit√©, etc.)</p>
        </div>
    </div>
</main>

<footer>
    <div style="color:white; font-weight:bold; margin-bottom:5px;">Site r√©alis√© par un stagiaire de la PMM de Belfort</div>
    <div>Alexis Sartoris - PMM Belfort - 2025/2026</div>
</footer>

<script>
    let currentScore = 0;
    let currentNatoMode = 'letter';
    let currentSacMode = 'homme'; 

    // --- SYST√àME DE PIOCHE (DECK) ---
    // decks[categorie] contiendra la liste des index m√©lang√©s (ex: [3, 0, 5, 2...])
    let decks = {}; 
    
    // File d'attente des mauvaises r√©ponses par cat√©gorie
    let retryQueues = {}; 
    
    // M√©morise la TOUTE derni√®re question pos√©e (pour √©viter le doublon imm√©diat lors d'un retry)
    let lastIndices = {};

    // --- DONN√âES NATO ---
    const natoData = [
        { l: "A", name: "ALFA", m: "J'ai un scaphandrier en plong√©e.", img: "images/flag_a.png" },
        { l: "B", name: "BRAVO", m: "Je charge/d√©charge des mati√®res dangereuses.", img: "images/flag_b.png" },
        { l: "C", name: "CHARLIE", m: "Affirmation (OUI).", img: "images/flag_c.png" },
        { l: "D", name: "DELTA", m: "Ne me g√™nez pas, je man≈ìuvre avec difficult√©.", img: "images/flag_d.png" },
        { l: "E", name: "ECHO", m: "Je viens sur tribord.", img: "images/flag_e.png" },
        { l: "F", name: "FOXTROT", m: "Je suis d√©sempar√©, communiquez avec moi.", img: "images/flag_f.png" },
        { l: "G", name: "GOLF", m: "J'ai besoin d'un pilote.", img: "images/flag_g.png" },
        { l: "H", name: "HOTEL", m: "J'ai un pilote √† bord.", img: "images/flag_h.png" },
        { l: "I", name: "INDIA", m: "Je viens sur b√¢bord.", img: "images/flag_i.png" },
        { l: "J", name: "JULIETT", m: "Incendie √† bord, √©cartez-vous.", img: "images/flag_j.png" },
        { l: "K", name: "KILO", m: "Je d√©sire communiquer.", img: "images/flag_k.png" },
        { l: "L", name: "LIMA", m: "Stoppez votre navire.", img: "images/flag_l.png" },
        { l: "M", name: "MIKE", m: "Mon navire est stopp√©.", img: "images/flag_m.png" },
        { l: "N", name: "NOVEMBER", m: "N√©gatif (NON).", img: "images/flag_n.png" },
        { l: "O", name: "OSCAR", m: "Homme √† la mer.", img: "images/flag_o.png" },
        { l: "P", name: "PAPA", m: "Rappel des √©quipages / Filets accroch√©s.", img: "images/flag_p.png" },
        { l: "Q", name: "QUEBEC", m: "Demande libre pratique (Sant√©).", img: "images/flag_q.png" },
        { l: "R", name: "ROMEO", m: "Pas de signification particuli√®re isol√©e.", img: "images/flag_r.png" },
        { l: "S", name: "SIERRA", m: "Je bats en arri√®re.", img: "images/flag_s.png" },
        { l: "T", name: "TANGO", m: "Ne me g√™nez pas, chalutage en cours.", img: "images/flag_t.png" },
        { l: "U", name: "UNIFORM", m: "Vous courez vers un danger.", img: "images/flag_u.png" },
        { l: "V", name: "VICTOR", m: "Je demande assistance.", img: "images/flag_v.png" },
        { l: "W", name: "WHISKEY", m: "Demande assistance m√©dicale.", img: "images/flag_w.png" },
        { l: "X", name: "X-RAY", m: "Arr√™tez vos man≈ìuvres et veillez mes signaux.", img: "images/flag_x.png" },
        { l: "Y", name: "YANKEE", m: "Je chasse sur mon ancre.", img: "images/flag_y.png" },
        { l: "Z", name: "ZULU", m: "J'ai besoin d'un remorqueur.", img: "images/flag_z.png" }
    ];

    // --- DONN√âES SAC ---
    const sacData = {
        homme: [
            "B√¢chi (avec pompon rouge)", "Vareuse bleue (repass√©e)", "Marini√®re (tricot ray√© bleu/blanc)",
            "Pantalon bleu marine (repass√©)", "Ceinturon blanc", "Chaussettes noires", "Gu√™tres",
            "Chaussures noires (cir√©es)", "Gants blancs", "Insignes et d√©corations",
            "Veste civile / Pull (pour apr√®s)", "Barres c√©r√©ali√®res (en cas de creux)"
        ],
        femme: [
            "Tricorne", "Chemise blanche", "Cravate noire", "Vareuse bleue (repass√©e)",
            "Pantalon bleu marine (repass√©)", "Ceinturon blanc", "Chaussettes noires", "Gu√™tres",
            "Chaussures noires (cir√©es)", "Gants blancs", "Insignes et d√©corations",
            "Mat√©riel chignon (barrettes/pinces)", "Veste civile / Pull (pour apr√®s)",
            "Barres c√©r√©ali√®res (en cas de creux)"
        ]
    };

    // --- BASE DE DONN√âES QUIZ ---
    const db = {
        grades: [
            // GRADES EXISTANTS
            { img: "images/grade_matelot.jpg", q: "Quel est ce grade ?", options: ["Matelot", "Quartier-Ma√Ætre de 2√®me classe", "Mousse"], a: 0, info: "Pas de galon = Matelot." },
            { img: "images/grade_qm2.jpg", q: "Quel est ce grade ?", options: ["Matelot", "Quartier-Ma√Ætre de 2√®me classe", "Quartier-Ma√Ætre de 1√®re classe"], a: 1, info: "2 chevrons rouges = Quartier-Ma√Ætre de 2√®me classe." },
            { img: "images/grade_qm1.jpg", q: "Quel est ce grade ?", options: ["Quartier-Ma√Ætre de 2√®me classe", "Quartier-Ma√Ætre de 1√®re classe", "Second Ma√Ætre"], a: 1, info: "1 chevron rouge = Quartier-Ma√Ætre de 1√®re classe." },
            { img: "images/grade_sm_maistrancier.jpg", q: "Quel est ce grade (barr√© de rouge) ?", options: ["Second Ma√Ætre Maistrancier", "Second Ma√Ætre", "Quartier-Ma√Ætre"], a: 0, info: "Second Ma√Ætre Maistrancier (√âl√®ve)." },
            { img: "images/grade_sm_brevete.jpg", q: "Quel est ce grade (barr√© de bleu) ?", options: ["Second Ma√Ætre Maistrancier", "Second Ma√Ætre Brevet√© Maistrancier", "Ma√Ætre"], a: 1, info: "Second Ma√Ætre Brevet√© Maistrancier." },
            { img: "images/grade_sm.jpg", q: "Quel est ce grade ?", options: ["Second Ma√Ætre", "Ma√Ætre", "Premier Ma√Ætre"], a: 0, info: "2 chevrons or = Second Ma√Ætre." },
            { img: "images/grade_m.jpg", q: "Quel est ce grade ?", options: ["Second Ma√Ætre", "Ma√Ætre", "Premier Ma√Ætre"], a: 1, info: "3 chevrons or = Ma√Ætre." },
            { img: "images/grade_pm.jpg", q: "Quel est ce grade ?", options: ["Ma√Ætre", "Premier Ma√Ætre", "Ma√Ætre Principal"], a: 1, info: "1 galon or = Premier Ma√Ætre." },
            { img: "images/grade_mp.jpg", q: "Quel est ce grade ?", options: ["Premier Ma√Ætre", "Ma√Ætre Principal", "Major"], a: 1, info: "1 galon or 'sabord√©' = Ma√Ætre Principal (Cipal)." },
            { img: "images/grade_major.jpg", q: "Quel est ce grade ?", options: ["Ma√Ætre Principal", "Major", "Aspirant"], a: 1, info: "1 galon or + ancre = Major." },
            { img: "images/grade_asp.jpg", q: "Quel est ce grade ?", options: ["Aspirant", "Enseigne de Vaisseau de 2√®me classe", "Enseigne de Vaisseau de 1√®re classe"], a: 0, info: "1 galon or coup√© = Aspirant (Lieutenant)." },
            { img: "images/grade_ev2.jpg", q: "Quel est ce grade ?", options: ["Aspirant", "Enseigne de Vaisseau de 2√®me classe", "Enseigne de Vaisseau de 1√®re classe"], a: 1, info: "1 galon or = Enseigne de Vaisseau de 2√®me classe." },
            { img: "images/grade_ev1.jpg", q: "Quel est ce grade ?", options: ["Enseigne de Vaisseau de 2√®me classe", "Enseigne de Vaisseau de 1√®re classe", "Lieutenant de Vaisseau"], a: 1, info: "2 galons or = Enseigne de Vaisseau de 1√®re classe." },
            { img: "images/grade_lv.jpg", q: "Quel est ce grade ?", options: ["Enseigne de Vaisseau de 1√®re classe", "Lieutenant de Vaisseau", "Capitaine de Corvette"], a: 1, info: "3 galons or = Lieutenant de Vaisseau (Capitaine)." },
            { img: "images/grade_cc.jpg", q: "Quel est ce grade ?", options: ["Lieutenant de Vaisseau", "Capitaine de Corvette", "Capitaine de Fr√©gate"], a: 1, info: "4 galons panach√©s = Capitaine de Corvette (Commandant)." },
            { img: "images/grade_cf.jpg", q: "Quel est ce grade ?", options: ["Capitaine de Corvette", "Capitaine de Fr√©gate", "Capitaine de Vaisseau"], a: 1, info: "5 galons panach√©s (3 Or, 2 Argent) = Capitaine de Fr√©gate." },
            { img: "images/grade_cv.jpg", q: "Quel est ce grade ?", options: ["Capitaine de Fr√©gate", "Capitaine de Vaisseau", "Contre-Amiral"], a: 1, info: "5 galons or = Capitaine de Vaisseau." },
            { img: "images/grade_ca.jpg", q: "Quel est ce grade ?", options: ["Capitaine de Vaisseau", "Contre-Amiral", "Vice-Amiral"], a: 1, info: "2 √©toiles = Contre-Amiral." },
            { img: "images/grade_va.jpg", q: "Quel est ce grade ?", options: ["Contre-Amiral", "Vice-Amiral", "Vice-Amiral d'Escadre"], a: 1, info: "3 √©toiles = Vice-Amiral." },
            { img: "images/grade_vae.jpg", q: "Quel est ce grade ?", options: ["Vice-Amiral", "Vice-Amiral d'Escadre", "Amiral"], a: 1, info: "4 √©toiles = Vice-Amiral d'Escadre." },
            { img: "images/grade_amiral.jpg", q: "Quel est ce grade ?", options: ["Vice-Amiral d'Escadre", "Amiral", "Amiral de France"], a: 1, info: "5 √©toiles = Amiral." },
            
            // COIFFES ET MACARONS
            { img: "images/coiffe_bachi.png", q: "Comment s'appelle cette coiffe ?", options: ["Le B√¢chi", "Le K√©pi", "Le Calot"], a: 0, info: "C'est le B√¢chi (bonnet de marin) avec sa c√©l√®bre houppette rouge." },
            { img: "images/coiffe_bachi.png", q: "Qui porte le B√¢chi ?", options: ["L'√âquipage (Militaires du rang)", "Les Officiers Mariniers", "Les Officiers"], a: 0, info: "Il est port√© par les Matelots et les Quartiers-Ma√Ætres." },
            { img: "images/coiffe_casquette.png", q: "Qui porte cette casquette ?", options: ["Officiers Mariniers & Officiers", "Uniquement les Amiraux", "Tout le monde"], a: 0, info: "Port√©e par le personnel masculin : Officiers Mariniers, Officiers et Officiers G√©n√©raux." },
            { img: "images/coiffe_tricorne.png", q: "Quel est ce chapeau f√©minin ?", options: ["Le Tricorne", "Le B√¢chi", "La Coiffe"], a: 0, info: "Le Tricorne. Il est port√© par le personnel f√©minin (sauf √âquipage qui porte un tricorne souple diff√©rent)." },
            { img: "images/macaron_equipage.png", q: "√Ä qui appartient ce macaron (insigne) ?", options: ["√âquipage", "Officier Marinier", "Officier"], a: 0, info: "Ancre ROUGE = √âquipage (Matelots et Quartiers-Ma√Ætres)." },
            { img: "images/macaron_om.png", q: "√Ä qui appartient ce macaron ?", options: ["Officier Marinier", "Officier", "Amiral"], a: 0, info: "Ancre D'OR seule = Officier Marinier." },
            { img: "images/macaron_officier.png", q: "√Ä qui appartient ce macaron ?", options: ["Officier", "Officier Marinier", "√âquipage"], a: 0, info: "Ancre entour√©e de LAURIERS = Officiers (et Aspirants)." },
            { img: "images/macaron_amiral.png", q: "√Ä qui appartient ce macaron ?", options: ["Officier G√©n√©ral (Amiral)", "Commandant", "Major"], a: 0, info: "Ancre AIL√âE avec √âTOILES = Officier G√©n√©ral (Amiral)." }
        ],

        navires: [
            { img: "images/navire_pa.jpg", q: "Type de b√¢timent ?", options: ["Porte-Avions", "Porte-H√©licopt√®res Amphibie", "B√¢timent Ravitailleur"], a: 0, info: "Porte-Avions (Charles de Gaulle)." },
            { img: "images/navire_fremm.jpg", q: "Type de b√¢timent ?", options: ["Fr√©gate de Surveillance", "Fr√©gate Multi-Missions", "Patrouilleur de Haute Mer"], a: 1, info: "Fr√©gate Multi-Missions (FREMM)." },
            { img: "images/navire_fremm_da.jpg", q: "Type de b√¢timent ?", options: ["Fr√©gate Multi-Mission √† capacit√© de d√©fense a√©rienne renforc√©e", "Fr√©gate Type La Fayette", "Patrouilleur"], a: 0, info: "Fr√©gate Multi-Mission √† capacit√© de d√©fense a√©rienne renforc√©e (FREMM-DA)." },
            { img: "images/navire_fdi.jpg", q: "Type de b√¢timent ?", options: ["Fr√©gate de D√©fense et d'Intervention", "Fr√©gate de Surveillance", "Chasseur de Mines"], a: 0, info: "Fr√©gate de D√©fense et d'Intervention (FDI)." },
            { img: "images/navire_fs.jpg", q: "Type de b√¢timent ?", options: ["Fr√©gate de Surveillance", "Patrouilleur Polaire", "B√¢timent Hydrographique"], a: 0, info: "Fr√©gate de Surveillance (Flor√©al)." },
            { img: "images/navire_phm.jpg", q: "Type de b√¢timent ?", options: ["Patrouilleur de Haute Mer", "Patrouilleur C√¥tier", "Chasseur de Mines"], a: 0, info: "Patrouilleur de Haute Mer (PHM)." },
            { img: "images/navire_pom.jpg", q: "Type de b√¢timent ?", options: ["Patrouilleur Outre-Mer", "Patrouilleur de Service Public", "B√¢timent de Soutien"], a: 0, info: "Patrouilleur Outre-Mer (POM)." },
            { img: "images/navire_pag.jpg", q: "Type de b√¢timent ?", options: ["Patrouilleur Antilles Guyane", "Patrouilleur de Haute Mer", "Remorqueur"], a: 0, info: "Patrouilleur Antilles Guyane (PAG)." },
            { img: "images/navire_psp.jpg", q: "Type de b√¢timent ?", options: ["Patrouilleur de Service Public", "B√¢timent Base de Plongeurs", "Engin de D√©barquement"], a: 0, info: "Patrouilleur de Service Public (PSP)." },
            { img: "images/navire_patrouilleur.jpg", q: "Type de b√¢timent ?", options: ["Patrouilleur", "Fr√©gate", "Porte-Avions"], a: 0, info: "Patrouilleur (Divers)." },
            { img: "images/navire_polaire.jpg", q: "Type de b√¢timent ?", options: ["Patrouilleur Polaire", "P√©trolier Ravitailleur", "B√¢timent d'Essais"], a: 0, info: "Patrouilleur Polaire (L'Astrolabe)." },
            { img: "images/navire_cmt.jpg", q: "Type de b√¢timent ?", options: ["Chasseur de Mines Tripartite", "Patrouilleur", "Remorqueur"], a: 0, info: "Chasseur de Mines Tripartite (CMT)." },
            { img: "images/navire_bbpd.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent Base de Plongeurs D√©mineurs", "B√¢timent Hydrographique", "Fr√©gate"], a: 0, info: "B√¢timent Base de Plongeurs D√©mineurs (BBPD)." },
            { img: "images/navire_brs.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent Remorqueur de Sonar", "B√¢timent Ravitailleur", "Chasseur de Mines"], a: 0, info: "B√¢timent Remorqueur de Sonar (BRS)." },
            { img: "images/navire_begm.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent d'Exp√©rimentation de Guerre des Mines", "B√¢timent √âcole", "Patrouilleur"], a: 0, info: "B√¢timent d'Exp√©rimentation de Guerre des Mines (BEGM)." },
            { img: "images/navire_brf.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent Ravitailleur de Forces", "B√¢timent de Soutien", "Porte-H√©licopt√®res"], a: 0, info: "B√¢timent Ravitailleur de Forces (BRF)." },
            { img: "images/navire_bcr.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent de Commandement et Ravitaillement", "Fr√©gate", "Patrouilleur"], a: 0, info: "B√¢timent de Commandement et Ravitaillement (BCR)." },
            { img: "images/navire_bsam.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent de Soutien et d'Assistance M√©tropolitain", "Patrouilleur", "Chasseur de Mines"], a: 0, info: "B√¢timent de Soutien et d'Assistance M√©tropolitain (BSAM)." },
            { img: "images/navire_bsaom.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent de Soutien et d'Assistance Outre-Mer", "Fr√©gate de Surveillance", "Patrouilleur"], a: 0, info: "B√¢timent de Soutien et d'Assistance Outre-Mer (BSAOM)." },
            { img: "images/navire_rpc.jpg", q: "Type de b√¢timent ?", options: ["Remorqueur Portuaire C√¥tier", "Patrouilleur", "Engin de D√©barquement"], a: 0, info: "Remorqueur Portuaire C√¥tier (RPC)." },
            { img: "images/navire_bem.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent d'Essais et de Mesures", "B√¢timent de Renseignement", "Porte-Avions"], a: 0, info: "B√¢timent d'Essais et de Mesures (BEM)." },
            { img: "images/navire_bre.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent de Renseignement √âlectromagn√©tique", "B√¢timent Hydrographique", "Fr√©gate"], a: 0, info: "B√¢timent de Renseignement √âlectromagn√©tique (BRE)." },
            { img: "images/navire_bho.jpg", q: "Type de b√¢timent ?", options: ["B√¢timent Hydrographique et Oc√©anographique", "Patrouilleur Polaire", "Chasseur de Mines"], a: 0, info: "B√¢timent Hydrographique et Oc√©anographique (BHO)." },
            { img: "images/navire_voilier.jpg", q: "Type de b√¢timent ?", options: ["Voilier √âcole", "Fr√©gate", "Patrouilleur"], a: 0, info: "Voilier √âcole." },
            { img: "images/navire_erf.jpg", q: "Type de b√¢timent ?", options: ["Embarcation Remonte Filets", "Engin de D√©barquement", "Remorqueur"], a: 0, info: "Embarcation Remonte Filets (ERF)." },
            { img: "images/navire_eda.jpg", q: "Type de b√¢timent ?", options: ["Engin de D√©barquement Amphibie", "Patrouilleur", "Remorqueur"], a: 0, info: "Engin de D√©barquement Amphibie (EDA)." }
        ],

        famas: [
            { img: "images/famas_ensemble_mobile.jpg", q: "Quelle est cette pi√®ce centrale ?", options: ["L'ensemble mobile", "La culasse", "Le percuteur"], a: 0, info: "L'ensemble mobile." },
            { img: "images/famas_chargeur.jpg", q: "Contenance du chargeur (G2) ?", options: ["30 cartouches", "25 cartouches", "20 cartouches"], a: 0, info: "30 cartouches (Standard OTAN)." },
            { img: "images/famas_selecteur.jpg", q: "Position '1' sur le s√©lecteur ?", options: ["Semi-auto (Coup par coup)", "Rafale", "S√ªret√©"], a: 0, info: "1 = Tir en coup par coup." },
            { img: "images/famas_general.jpg", q: "Quel est ce mod√®le ?", options: ["FAMAS G2", "FAMAS F1", "HK 416"], a: 0, info: "FAMAS G2 (Pontet large)." },
            { img: "images/famas_boitier.jpg", q: "Nom de cette pi√®ce ?", options: ["Bo√Ætier de m√©canisme", "Ensemble mobile", "PGM"], a: 0, info: "Bo√Ætier de M√©canisme (Pi√®ce de s√©curit√©)." },
            { img: "images/famas_limiteur.jpg", q: "√Ä quoi sert la commande '0' ou '3' ?", options: ["Limiteur de rafale", "S√©lecteur de tir", "S√ªret√©"], a: 0, info: "Limiteur de Rafale (0=Libre, 3=Trois coups)." },
            { img: "images/famas_poignee.jpg", q: "Identifiez cet ensemble :", options: ["Poign√©e Garde-Main (PGM)", "Crosse", "Canon"], a: 0, info: "Poign√©e Garde-Main." },
            { img: "images/famas_crosse.jpg", q: "Pi√®ce mobile pour viser sur la crosse ?", options: ["L'appui-joue", "L'amortisseur", "La fen√™tre d'√©jection"], a: 0, info: "L'appui-joue." },
            { q: "Port√©e pratique du FAMAS G2 ?", options: ["300 m", "200 m", "600 m"], a: 0, info: "300 m√®tres." },
            { q: "Cadence de tir th√©orique ?", options: ["1000 coups/mn", "600 coups/mn", "100 coups/mn"], a: 0, info: "1000 √† 1100 coups/minute." },
            { q: "Grenades tir√©es par le FAMAS ?", options: ["Mixtes (AP/AV)", "Fumig√®nes", "De 120mm"], a: 0, info: "Grenades Mixtes (Anti-Personnel / Anti-V√©hicule)." }
        ]
    };

    // --- MOTEUR ---
    
    function switchTab(id) {
        document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        // Hack pour activer le bouton de nav m√™me si l'appel ne vient pas du clic direct
        if(event && event.target && event.target.tagName === 'BUTTON') {
             event.target.classList.add('active');
        } else {
             const btn = document.querySelector(`nav button[onclick="switchTab('${id}')"]`);
             if(btn) btn.classList.add('active');
        }
        
        if (id === 'nato') {
            loadNatoQuestion();
        } else if (id === 'bonus') {
            loadChecklist();
        } else if (db[id]) {
            loadQuestion(id);
        }
    }

    // Gestion des modes NATO
    function setNatoMode(mode) {
        currentNatoMode = mode;
        document.getElementById('btn-nato-letter').classList.toggle('active', mode === 'letter');
        document.getElementById('btn-nato-meaning').classList.toggle('active', mode === 'meaning');
        loadNatoQuestion();
    }

    // Fonction de m√©lange (Fisher-Yates)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function loadQuestion(cat) {
        const container = document.getElementById(`quiz-${cat}`);
        
        // Initialisation si n√©cessaire
        if (!retryQueues[cat]) retryQueues[cat] = [];
        if (!decks[cat]) decks[cat] = [];

        let index = -1;
        
        // 1. GESTION DES ERREURS (Priorit√© : 1 chance sur 2 si file non vide)
        // On v√©rifie qu'on ne repose pas imm√©diatement la question qu'on vient de rater/voir
        if (retryQueues[cat].length > 0 && Math.random() < 0.5) {
            let candidate = retryQueues[cat][0];
            if (candidate !== lastIndices[cat]) {
                index = retryQueues[cat].shift();
            }
        }

        // 2. GESTION DU DECK (Pioche)
        if (index === -1) {
            // Si le deck est vide, on le remplit et on m√©lange
            if (decks[cat].length === 0) {
                // Cr√©er un tableau [0, 1, 2, ..., n]
                decks[cat] = Array.from({length: db[cat].length}, (_, i) => i);
                shuffleArray(decks[cat]);
                
                // Anti-doublon √† la coupe : Si la nouvelle premi√®re carte est la m√™me que la derni√®re vue
                if (decks[cat][0] === lastIndices[cat] && decks[cat].length > 1) {
                    // On met la premi√®re carte √† la fin
                    decks[cat].push(decks[cat].shift());
                }
            }
            // On tire la carte du dessus
            index = decks[cat].pop();
        }

        // M√©morisation pour l'anti-r√©p√©tition imm√©diate
        lastIndices[cat] = index;

        const qData = db[cat][index];
        renderQuizCard(container, qData, cat, false, index);
    }

    function loadNatoQuestion() {
        // Le NATO a beaucoup de lettres, le random simple passe encore, 
        // mais on pourrait appliquer le deck ici aussi. Pour l'instant on garde le random simple
        // car le mode switch entre lettre et signification.
        const container = document.getElementById('quiz-nato');
        const item = natoData[Math.floor(Math.random() * natoData.length)];
        let qData = {};

        if (currentNatoMode === 'letter') {
            // MODE LETTRE
            qData = {
                img: item.img,
                q: "Quel est ce pavillon ?",
                info: `${item.name} : ${item.m}`,
                a: 0
            };
            let others = natoData.filter(x => x.l !== item.l).sort(() => 0.5 - Math.random()).slice(0, 2);
            qData.options = [item.name, others[0].name, others[1].name];

        } else {
            // MODE SIGNIFICATION
            qData = {
                img: item.img,
                q: `Que signifie le pavillon ${item.name} ?`,
                info: `${item.name} : ${item.m}`,
                a: 0
            };
            let others = natoData.filter(x => x.l !== item.l).sort(() => 0.5 - Math.random()).slice(0, 2);
            qData.options = [item.m, others[0].m, others[1].m];
        }

        renderQuizCard(container, qData, 'nato', true);
    }

    function renderQuizCard(container, qData, cat, isNato = false, questionIndex = -1) {
        let options = qData.options.map((opt, index) => {
            return { text: opt, isCorrect: (index === qData.a) };
        });
        options = options.sort(() => Math.random() - 0.5);

        let imageHTML = '';
        if (qData.img) {
            let imgClass = cat === 'nato' ? 'quiz-image flag-img-large' : 'quiz-image';
            imageHTML = `
                <div class="quiz-image-container">
                    <img src="${qData.img}" class="${imgClass}" alt="Image" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'color:#999\\'>Image manquante<br>${qData.img}</span>'">
                </div>`;
        }
        
        const safeInfo = qData.info.replace(/'/g, "\\'");
        const safeCat = cat ? cat : '';

        container.innerHTML = `
            <div class="question-card">
                ${imageHTML}
                <div class="question-text">${qData.q}</div>
                <div class="options-grid">
                    ${options.map(opt => 
                        `<button class="opt-btn" onclick="check(this, ${opt.isCorrect}, '${safeInfo}', '${safeCat}', ${questionIndex})">${opt.text}</button>`
                    ).join('')}
                </div>
                <div class="feedback-box"></div>
                <button class="btn-next" onclick="${isNato ? 'loadNatoQuestion()' : `loadQuestion('${cat}')`}">Question Suivante ‚Üí</button>
            </div>
        `;
    }

    function check(btn, isCorrect, info, cat, index) {
        const card = btn.closest('.question-card');
        const feedback = card.querySelector('.feedback-box');
        
        card.querySelectorAll('.opt-btn').forEach(b => {
            b.disabled = true;
            if(b === btn && !isCorrect) {
                b.style.background = "#ffebee";
                b.style.borderColor = "#ffcdd2";
                b.style.color = "#c62828";
            }
        });

        if(isCorrect) {
            btn.style.background = "#e8f5e9";
            btn.style.borderColor = "#a5d6a7";
            btn.style.color = "#2e7d32";
            feedback.innerHTML = `<strong style="color:#2e7d32;">‚úî Bonne r√©ponse !</strong><br>${info}`;
            feedback.style.background = "#e8f5e9";
            feedback.style.border = "1px solid #c8e6c9";
            updateScore(10);
        } else {
            feedback.innerHTML = `<strong style="color:#c62828;">‚úò Incorrect.</strong><br>${info}`;
            feedback.style.background = "#ffebee";
            feedback.style.border = "1px solid #ffcdd2";
            
            // LOGIQUE DE R√âVISION : Ajout √† la file d'attente
            if (cat && cat !== 'nato' && index !== -1) {
                if (!retryQueues[cat]) retryQueues[cat] = [];
                // On √©vite les doublons dans la file d'attente
                if (!retryQueues[cat].includes(index)) {
                    retryQueues[cat].push(index);
                }
            }
        }
        
        feedback.style.display = 'block';
        card.querySelector('.btn-next').style.display = 'block';
    }

    function updateScore(points) {
        currentScore += points;
        document.getElementById('score-val').innerText = currentScore;
    }

    function translateNato(text) {
        const output = document.getElementById('nato-res');
        if(!text.trim()) { output.innerHTML = "<span style='color:#aaa; font-style:italic;'>R√©sultat...</span>"; return; }
        
        output.innerHTML = text.toUpperCase().split('').map(char => {
            let found = natoData.find(item => item.l === char);
            if (found) {
                return `<div class="nato-item">
                            <img src="${found.img}" class="nato-flag-mini" onerror="this.style.display='none'">
                            ${found.name}
                        </div>`;
            } else if (char.match(/[0-9]/)) {
                 return `<div class="nato-item">${char}</div>`;
            }
            return char === ' ' ? '<div style="width:100%"></div>' : '';
        }).join('');
    }

    // --- GESTION CHECKLIST (SAC) ---
    function setSacMode(mode) {
        currentSacMode = mode;
        document.getElementById('btn-sac-homme').classList.toggle('active', mode === 'homme');
        document.getElementById('btn-sac-femme').classList.toggle('active', mode === 'femme');
        loadChecklist();
    }

    function loadChecklist() {
        const container = document.getElementById('checklist-container');
        container.innerHTML = "";
        
        const items = sacData[currentSacMode];
        
        items.forEach((item, index) => {
            const storageKey = `pmm_sac_${currentSacMode}_${index}`;
            const isChecked = localStorage.getItem(storageKey) === 'true';
            
            const div = document.createElement('div');
            div.style.padding = "15px 5px";
            div.style.borderBottom = "1px solid #eee";
            div.style.display = "flex";
            div.style.alignItems = "center";
            div.style.cursor = "pointer";
            
            div.onclick = (e) => {
                if(e.target.type !== 'checkbox') {
                    const chk = div.querySelector('input');
                    chk.checked = !chk.checked;
                    saveCheck(storageKey, chk.checked);
                }
            };

            div.innerHTML = `
                <input type="checkbox" id="chk_${index}" ${isChecked ? 'checked' : ''} 
                    onchange="saveCheck('${storageKey}', this.checked)" 
                    style="transform: scale(1.5); margin-right: 15px; cursor:pointer;">
                <label for="chk_${index}" style="font-size:1.05rem; cursor:pointer; flex:1; ${isChecked ? 'text-decoration:line-through; color:#aaa;' : ''}">${item}</label>
            `; 
            container.appendChild(div);
        });
    }

    function saveCheck(key, status) {
        localStorage.setItem(key, status);
        loadChecklist();
    }

    function resetChecklist() {
        if(confirm("Voulez-vous vraiment d√©cocher toute la liste " + currentSacMode + " ?")) {
            const items = sacData[currentSacMode];
            items.forEach((_, i) => localStorage.removeItem(`pmm_sac_${currentSacMode}_${i}`));
            loadChecklist();
        }
    }

    // --- CHANTS ---
    const chantsLyrics = {
        santiano: "C'est un fameux trois-m√¢ts fin comme un oiseau\nHisse et ho, Santiano !\nDix-huit n≈ìuds, quatre cent tonneaux\nJe suis fier d'y √™tre matelot\n\n(Refrain)\nTiens bon la vague et tiens bon le vent\nHisse et ho, Santiano !\nSi Dieu veut toujours droit devant\nNous irons jusqu'√† San Francisco\n\nJe pars pour de longs mois en laissant Margot\nHisse et ho, Santiano !\nD'y penser j'avais le c≈ìur gros\nEn doublant les feux de Saint-Malo\n\n(Refrain)\n\nOn pr√©tend que l√†-bas l'argent coule √† flots\nHisse et ho, Santiano !\nOn trouve l'or au fond des ruisseaux\nJ'en ram√®nerai plusieurs lingots\n\n(Refrain)\n\nUn jour, je reviendrai charg√© de cadeaux\nHisse et ho, Santiano !\nAu pays, j'irai voir Margot\n√Ä son doigt, je passerai l'anneau\n\n(Refrain)",
        
        strasbourgeoise: "Petit papa voici la mi-car√™me,\nCar te voici d√©guis√© en soldat.\nPetit papa dis-moi si c'est pour rire,\nOu pour faire peur aux tout petits enfants ?\n\n(Refrain)\nNon mon enfant je pars pour la patrie,\nC'est un devoir o√π tous les papas s'en vont,\nEmbrasse-moi petite fille ch√©rie,\nJe rentrerai bien vite √† la maison.\n\nDis-moi maman quelle est cette m√©daille,\nEt cette lettre qu'apporte le facteur ?\nDis-moi maman tu pleures et tu d√©failles,\nIls ont tu√© petit papa ch√©ri.\n\n(Dernier couplet)\nLa neige tombe aux portes de la ville,\nL√† est assis un enfant de Strasbourg.\nIl reste l√† malgr√© le froid la bise,\nIl reste l√† malgr√© le froid du jour.\nUn homme passe et √† l'enfant il donne,\nUn peu d'argent, petit n'a plus de toit.\nSa m√®re est morte et son p√®re est en France,\nIl n'a plus rien, plus de maison √† soi.",
};

    function showChant(chantKey) {
        const display = document.getElementById('chant-display');
        if(chantKey && chantsLyrics[chantKey]) {
            display.style.display = 'block';
            display.textContent = chantsLyrics[chantKey];
        } else {
            display.style.display = 'none';
        }
    }

    // Init
    loadQuestion('grades');
</script>

</body>
</html>
